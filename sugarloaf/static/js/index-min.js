function buildCharts(){sugarloaf.ndx=crossfilter(sugarloaf.data.trails),sugarloaf.openDim=sugarloaf.ndx.dimension(function(a){return a.open?"Open":"Closed"}),sugarloaf.openGroup=sugarloaf.openDim.group().reduceCount(function(a){return a.open}),sugarloaf.openChart=dc.rowChart("#chart-row-open"),sugarloaf.openChart.width(WIDTH).height(HEIGHT/2).margins(MARGINS).dimension(sugarloaf.openDim).group(sugarloaf.openGroup).elasticX(!0),sugarloaf.groomedDim=sugarloaf.ndx.dimension(function(a){return a.groomed?"Groomed":"Ungroomed"}),sugarloaf.groomedGroup=sugarloaf.groomedDim.group().reduceCount(function(a){return a.groomed}),sugarloaf.groomedChart=dc.rowChart("#chart-row-groomed"),sugarloaf.groomedChart.width(WIDTH).height(HEIGHT/2).margins(MARGINS).dimension(sugarloaf.groomedDim).group(sugarloaf.groomedGroup).elasticX(!0),sugarloaf.snowmakingDim=sugarloaf.ndx.dimension(function(a){return a.snowmaking?"Snowmaking in progress":"Not snowmaking"}),sugarloaf.snowmakingGroup=sugarloaf.snowmakingDim.group().reduceCount(function(a){return a.snowmaking}),sugarloaf.snowmakingChart=dc.rowChart("#chart-row-snowmaking"),sugarloaf.snowmakingChart.width(WIDTH).height(HEIGHT/2).margins(MARGINS).dimension(sugarloaf.snowmakingDim).group(sugarloaf.snowmakingGroup).elasticX(!0),sugarloaf.difficultyDim=sugarloaf.ndx.dimension(function(a){return a.difficulty}),sugarloaf.difficultyGroup=sugarloaf.difficultyDim.group().reduceCount(function(a){return a.difficulty}),sugarloaf.difficultyChart=dc.rowChart("#chart-row-difficulty"),sugarloaf.difficultyChart.width(WIDTH).height(HEIGHT).margins(MARGINS).dimension(sugarloaf.difficultyDim).group(sugarloaf.difficultyGroup).ordering(function(a){return sugarloaf.difficulty_order[a.key]}).elasticX(!0),sugarloaf.areaDim=sugarloaf.ndx.dimension(function(a){return a.area}),sugarloaf.areaGroup=sugarloaf.areaDim.group().reduceCount(function(a){return a.area}),sugarloaf.areaChart=dc.rowChart("#chart-row-area"),sugarloaf.areaChart.width(WIDTH).height(2*HEIGHT).margins(MARGINS).dimension(sugarloaf.areaDim).group(sugarloaf.areaGroup).elasticX(!0),dc.renderAll()}function summaryToDates(a){var r={};a.conditions.forEach(function(a){void 0===r[a.datetime]&&(r[a.datetime]={}),a.open&&void 0===r[a.datetime][a.difficulty]?r[a.datetime][a.difficulty]=a.trail_count:a.open?r[a.datetime][a.difficulty]+=a.trail_count:void 0===r[a.datetime].closed?r[a.datetime].closed=a.trail_count:r[a.datetime].closed+=a.trail_count});var o=[];return Object.keys(r).forEach(function(a){var t=r[a];t.datetime=a,o.push(t)}),o}function buildSummaryChart(a){var r=summaryToDates(a),o=800-MARGINS.left-MARGINS.right,t=200-MARGINS.top-MARGINS.bottom;sugarloaf.summary_x=d3.scale.ordinal().rangeRoundBands([0,o],.1).domain(r.map(function(a){return a.datetime})),sugarloaf.summary_y=d3.scale.linear().rangeRound([t,0]),sugarloaf.summary_stack=d3.layout.stack().offset("zero").values(function(a){return a.values}).x(function(a){return x(a.datetime)}).y(function(a){return a.value}),sugarloaf.summary_color=d3.scale.ordinal().range(["#05FF00","#0040FF","#6D6D6D","#000","#F6AE3B","#FFF"]).domain(["green","blue","black","double-black","terrain-park","closed"]);var n=d3.select("#chart-summary").append("svg").attr("width",o+MARGINS.left+MARGINS.right).attr("height",t+MARGINS.top+MARGINS.bottom).append("g").attr("transform","translate("+MARGINS.left+","+MARGINS.top+")"),e=n.selectAll(".series").data(r).enter().append("g").attr("class","series")}var filename_status="/api/current",filename_summary="/api/summary",WIDTH=300,HEIGHT=200,MARGINS={top:10,left:20,right:20,bottom:20},sugarloaf={};sugarloaf.difficulty_order={beginner:1,intermediate:2,black:3,"double-black":4,"terrain-park":5},d3.json(filename_status,function(a){sugarloaf.data=a,buildCharts()}),d3.json(filename_summary,function(a){sugarloaf.summary=a,buildSummaryChart(sugarloaf.summary)});